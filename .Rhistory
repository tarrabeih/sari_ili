enroll_date <- as.Date(sari$de_fl_specimen_collection_date)
date_of_birth <- as.Date(substr(sari$tea_fl_date_of_birth, 1, 10))
# Calculate the interval between the dates
interval <- interval(date_of_birth, enroll_date)
# Convert the interval to a period
period <- as.period(interval)
# Extract the number of years and months
AgeYear <- period@year
AgeMonths <- period@month
AgeMonths = ifelse(AgeMonths=="0" & AgeYear=="0", "1",AgeMonths)
AddressGovernorate = lbn_c$province[ match(sari$tea_fl_caza_of_residence, lbn_c$caza_code) ]
District = lbn_c$caza[ match(sari$tea_fl_caza_of_residence, lbn_c$caza_code) ]
# FirstInterviewDate =  format(as.Date(substr(sari$de_fl_specimen_collection_date, 1, 10), format = "%Y-%m-%d"), date_format)
FirstInterviewDate = NA #By Amir
AdmissionDate = format(as.Date(substr(sari$de_fl_hospital_admission_date, 1, 10), format = "%Y-%m-%d"), date_format)
SymptomOnsetDate = format(as.Date(substr(sari$de_fl_date_onset, 1, 10), format = "%Y-%m-%d"), date_format)
HospitalId = sari$tea_fl_local_id
OutcomeDate = format(as.Date(substr(sari$de_fl_discharge_date, 1, 10), format = "%Y-%m-%d"), date_format)
Outcome = ifelse(sari$de_fl_discharge_status==1, "Discharge", ifelse(sari$de_fl_discharge_status==2,"Transfer", ifelse(sari$de_fl_discharge_status==3, "Death","Unknown")))
Temperature = sari$de_fl_fever_c
Ventilation = case_when(
sari$de_fl_mechanical_ventilation == "0" ~ "No",
sari$de_fl_mechanical_ventilation == "1" ~ "Yes",
sari$de_fl_mechanical_ventilation == "2" ~ "Yes",
sari$de_fl_mechanical_ventilation == "9" ~ NA,
TRUE ~ NA_character_  # Set default value to NA
)
ICUAddmission = ifelse(sari$de_fl_ward==3,"Yes","No")
AdmissionWard = case_when(
sari$de_fl_ward == "1" ~ "internal medicine",
sari$de_fl_ward == "2" ~ "pediatrics",
sari$de_fl_ward == "3" ~ "intensive care unit",
sari$de_fl_ward == "4" ~ "gyneco obstetrics",
sari$de_fl_ward == "5" ~ "other",
sari$de_fl_ward == "9" ~ "unspecified",
TRUE~NA
) ####
Pregnancy =  ifelse(sari$tea_fl_gender == 1, NA,
ifelse(sari$tea_fl_gender == 2, sari$de_fl_pregnancy, "No"))
Pregnancy = ifelse(Pregnancy=="1","Yes","No")
VaccinationForInfluenzaLast6months = ifelse(sari$de_fl_vaccination_flu==1 ,"Yes", ifelse(sari$de_fl_vaccination_flu==0,"No","Unknown"))
ReceiveInfluenzaAntiviralDrugsLast14days = ifelse(sari$de_fl_antiviral_treatement==1 ,"Yes", ifelse(sari$de_fl_antiviral_treatement==0,"No","Unknown"))
# Your initial data assignment
sari$de_fl_chronic_respiratory_diseases[sari$de_fl_chronic_respiratory_diseases == 1] <- "Chronic lung disease,"
sari$de_fl_chronic_cardiac_diseases[sari$de_fl_chronic_cardiac_diseases == 1] <- "Heart disease,"
sari$de_fl_diabetes[sari$de_fl_diabetes == 1] <- "Diabetes,"
sari$de_fl_chronic_liver_diseases[sari$de_fl_chronic_liver_diseases == 1] <- "Chronic liver disease,"
sari$de_fl_chronic_kidney_diseases[sari$de_fl_chronic_kidney_diseases == 1] <- "Chronic kidney disease,"
sari$de_fl_chronic_hematological_disorders[sari$de_fl_chronic_hematological_disorders == 1] <- "Chronic hematological disorder,"
sari$de_fl_neuromuscular_dysfunction[sari$de_fl_neuromuscular_dysfunction == 1] <- "Neuromuscular dysfunction,"
sari$de_fl_immuno_compromised[sari$de_fl_immuno_compromised == 1] <- "Immune compromised,"
sari$de_fl_other_diseases[sari$de_fl_other_diseases == 1] <- "Other,"
# Combine strings into one
`ChronicMedicalConditions (Comma Seperated)` <- paste(sari$de_fl_chronic_respiratory_diseases,
sari$de_fl_chronic_cardiac_diseases,
sari$de_fl_diabetes,
sari$de_fl_chronic_liver_diseases,
sari$de_fl_chronic_kidney_diseases,
sari$de_fl_chronic_hematological_disorders,
sari$de_fl_neuromuscular_dysfunction,
sari$de_fl_immuno_compromised,
sari$de_fl_other_diseases, sep = "")
# Remove NA and 0 from the string
`ChronicMedicalConditions (Comma Seperated)` <- gsub("NA", "", `ChronicMedicalConditions (Comma Seperated)`)
`ChronicMedicalConditions (Comma Seperated)` <- gsub("0", "", `ChronicMedicalConditions (Comma Seperated)`)
# Remove the last comma if it exists
`ChronicMedicalConditions (Comma Seperated)` <- sub(",\\s*$", "", `ChronicMedicalConditions (Comma Seperated)`)
`ChronicMedicalConditions (Comma Seperated)`[is.na(`ChronicMedicalConditions (Comma Seperated)`) | `ChronicMedicalConditions (Comma Seperated)`=="" | `ChronicMedicalConditions (Comma Seperated)`=="No"] = NA
test = `ChronicMedicalConditions (Comma Seperated)`
Lab_DateSpecimenCollected =  format(as.Date(substr(sari$de_fl_specimen_collection_date, 1, 10), format = "%Y-%m-%d"), date_format)
Lab_DateOfShipment = format(as.Date(substr(sari$de_fl_date_reception_specimen, 1, 10), format = "%Y-%m-%d"), date_format)
Lab_DateLabReceivedSpecimen = format(as.Date(substr(sari$de_fl_date_reception_specimen, 1, 10), format = "%Y-%m-%d"), date_format)
Lab_OropharyngealSpecimen = ifelse(sari$de_fl_specimen_type == 1, "Yes", "No")
Lab_NasopharyngealSpecimen = ifelse(sari$de_fl_specimen_type == 2, "Yes", "No")
Lab_BloodSpecimen = NA
Lab_SpecimenOther = ifelse(sari$de_fl_specimen_type == 8,"Yes", "No")
Lab_DateResultsReported = format(as.Date(substr(sari$de_fl_date_pcr_result, 1, 10), format = "%Y-%m-%d"), date_format)
Lab_Comments = NA
#### start lab result
influ = recode(
as.character(sari$de_fl_influenza_classification),
"a" = "influenza: a",
"ah1" = "Influenza: ah1",
"ah1ah3" = "influenza: ah1+ah3",
"ah3" = "influenza: ah3",
"ah5" = "influenza: ah5",
"ah7" = "influenza: ah7",
"b" = "influenza: b",
"bv" = "influenza: b victoria",
"by" = "influenza: b yamagata",
"2" = "Negative",
"9" = "Not tested",
"8" = "Other",
.default = NA_character_
)
covid = recode(
as.character(sari$de_fl_covid_classification),
"1" = "Positive [1]",
"2" = "Negative [2]",
"3" = "Border-Line [3]",
"4" = "Inadequate Sample [4",
.default = NA_character_
)
rsv  = recode(
as.character(sari$de_fl_pcr_rsv_classification),
"0" = "0_negative",
"1" = "1_positive",
"9" = "9_not processed",
.default = NA_character_
)
LabResult <- ifelse(
rsv %in% c("1_positive") |
covid %in% c("Positive [1]") |
influ %in% c(
"influenza: a", "Influenza: ah1", "influenza: ah3", "influenza: ah5",
"influenza: ah7", "influenza: b", "influenza: b yamagata",
"influenza: b victoria", "influenza: ah1+ah3", "Other"
), "Positive",
ifelse(
(influ == "Negative" & covid == "Negative [2]") | rsv != "1_positive",
"Negative",
ifelse(
influ == "Not tested" & covid == "Inadequate Sample [4" & rsv == "9_not processed",
"Not tested",
NA
)
)
)
LabResult = ifelse(is.na(LabResult),"Not tested",LabResult)
#### end lab result
#### PositiveViruses (Comma Seperated)
influ <- recode(
as.character(sari$de_fl_influenza_classification),
"a" = "Not-subtyped",
"ah1" = "(H1N1)pdm009",
"ah1ah3" = "Mixed",
"ah3" = "(H3N2)",
"ah5" = "(H5N1)",
"b" = "Lineage not determined",
"bv" = "Victoria lineage",
"by" = "Yamagata lineage",
.default = NA_character_
)
influ[influ==2] = NA # negative
influ[influ==9] = NA # not tested
PositiveViruses = character(nrow(sari))
for (i in 1:nrow(sari) ){
tested_virus_list <- character()
if (LabResult[i] == "Positive" && !is.na(influ[i]) && influ[i] != "Not tested" && influ[i] != "Negative") {
tested_virus_list <- c(tested_virus_list, influ[i])
}
if (LabResult[i] == "Positive" && !is.na(covid[i]) && covid[i]  == "Positive [1]") {
tested_virus_list <- c(tested_virus_list, "COVID-19")
}
if (LabResult[i] == "Positive" && !is.na(rsv[i]) && rsv[i] == "1_positive") {
tested_virus_list <- c(tested_virus_list, "RSV")
}
PositiveViruses[i] <- paste(tested_virus_list, collapse = ",")
}
`PositiveViruses (Comma Seperated)`=  PositiveViruses
#### end PositiveViruses (Comma Seperated)
HistoryTravel = ifelse(sari$de_fl_travel_history_21d==1,"Yes",ifelse(sari$de_fl_travel_history_21d==0,"No","Unknown"))
HistoryTravel_Where = country_code$Country[ match( sari$de_fl_country_visited,country_code$Alpha_3_code) ]
HistoryTravel_When = NA
VirusName_RSV = recode(
as.character(sari$de_fl_pcr_rsv_classification),
"0" = "negative",
"1" = "positive",
"9" = "not processed",
.default = NA_character_
)
# `TestedViruses (Comma Seperated)` = ifelse(VirusName_RSV=="negative" | VirusName_RSV=="positive","Not-subtyped, COVID-19, RSV","Not-subtyped, COVID-19")
# influ[is.na(influ)]=""
`TestedViruses (Comma Seperated)` = ifelse(VirusName_RSV=="negative" | VirusName_RSV=="positive","Not-subtyped,COVID-19,RSV","Not-subtyped,COVID-19")
`TestedViruses (Comma Seperated)`= ifelse((LabResult=="Negative" | LabResult=="Positive") & is.na(VirusName_RSV),"Not-subtyped,COVID-19",`TestedViruses (Comma Seperated)`)
# gsub("text", "word", string)
influ <- recode(
as.character(sari$de_fl_influenza_classification),
"a" = "Not-subtyped",
"ah1" = "(H1N1)pdm009",
"ah1ah3" = "Mixed",
"ah3" = "(H3N2)",
"ah5" = "(H5N1)",
"b" = "Lineage not determined",
"bv" = "Victoria lineage",
"by" = "Yamagata lineage",
.default = NA_character_
)
influ[influ==2] = NA #negative
influ[influ==9] = NA #not tested
`TestedViruses (Comma Seperated)`=ifelse(influ %in% c("(H1N1)pdm009", "Mixed", "(H3N2)", "(H5N1)", "Lineage not determined", "Victoria lineage", "Yamagata lineage"),str_replace(`TestedViruses (Comma Seperated)`,"Not-subtyped", influ), `TestedViruses (Comma Seperated)` )
View(sari)
`TestedViruses (Comma Seperated)`
library(stringr)
Country = "Lebanon"
sub = substr( sari$organisation_unit_name,1,2)
sub_caza =
ifelse(sub=="AK","Akkar",
ifelse(sub=="AL","Aleyh",
ifelse(sub=="BD","Baabda",
ifelse(sub=="BL","Baalbeck",
ifelse(sub=="BT","Batroun",
ifelse(sub=="BC","Becharreh",
ifelse(sub=="BR","Beirut",
ifelse(sub=="WB","Beqaa Gharby",
ifelse(sub=="BJ","Bint Jbeil",
ifelse(sub=="CH","Chouf",
ifelse(sub=="HS","Hasbaya",
ifelse(sub=="HR","Hermel",
ifelse(sub=="JB","Jbeil",
ifelse(sub=="JZ","Jezzine",
ifelse(sub=="KW","Kesrwan",
ifelse(sub=="KR","Koura",
ifelse(sub=="MR","Marjeoun",
ifelse(sub=="MT","Matn",
ifelse(sub=="MD","Mineh Danieh",
ifelse(sub=="NB","Nabatieh",
ifelse(sub=="RS","Rashaya",
ifelse(sub=="SD","Saida",
ifelse(sub=="SR","Sour",
ifelse(sub=="TR","Tripoli",
ifelse(sub=="ZH","Zahleh",
ifelse(sub=="ZG","Zgharta","UN"))))))))))))))))))))))))))
Governorate = lbn_c$province[ match(sub_caza, lbn_c$caza) ] #match
Site = substr(sari$organisation_unit_name,1,6)
Nationailty =   country_code$Country[ match( sari$tea_fl_nationality,country_code$Alpha_3_code) ]
Nationailty = sub(c(", State of"), "", Nationailty)
Nationailty = sub(c(" Arab Republic"), "", Nationailty)
Nationailty = recode(
Nationailty,
"Bangladesh"="Bangladeshi",
"Egypt"="Egyptian",
"Ethiopia"= "Ethiopian",
"Ghana" = "Ghanaian",
"Iraq" = "Iraqi",
"Lebanon" = "Lebanese",
"Palestine" = "Palestinian",
"Romania" = "Romanian",
"Sri Lanka" = "Sri Lankan",
"Sudan (the)" = "Sudanese",
"Syrian Arab Republic" = "Syrian",
"Turkey" = "Turkish",
"Ukraine" = "Ukrainian",
"Philippines (the)" = "Filipino",
"Nigeria" = "Nigerian"
)
Gender =  ifelse(sari$tea_fl_gender=="1","Male", ifelse(sari$tea_fl_gender=="2","Female","Unknown"))
Telephone = NA #check
Address =  NA #check
BirthDate = format(as.Date(substr(sari$tea_fl_date_of_birth, 1, 10), format = "%Y-%m-%d"), date_format)
# Convert the dates to Date objects
enroll_date <- as.Date(sari$de_fl_specimen_collection_date)
date_of_birth <- as.Date(substr(sari$tea_fl_date_of_birth, 1, 10))
# Calculate the interval between the dates
interval <- interval(date_of_birth, enroll_date)
# Convert the interval to a period
period <- as.period(interval)
# Extract the number of years and months
AgeYear <- period@year
AgeMonths <- period@month
AgeMonths = ifelse(AgeMonths=="0" & AgeYear=="0", "1",AgeMonths)
AddressGovernorate = lbn_c$province[ match(sari$tea_fl_caza_of_residence, lbn_c$caza_code) ]
District = lbn_c$caza[ match(sari$tea_fl_caza_of_residence, lbn_c$caza_code) ]
# FirstInterviewDate =  format(as.Date(substr(sari$de_fl_specimen_collection_date, 1, 10), format = "%Y-%m-%d"), date_format)
FirstInterviewDate = NA #By Amir
AdmissionDate = format(as.Date(substr(sari$de_fl_hospital_admission_date, 1, 10), format = "%Y-%m-%d"), date_format)
SymptomOnsetDate = format(as.Date(substr(sari$de_fl_date_onset, 1, 10), format = "%Y-%m-%d"), date_format)
HospitalId = sari$tea_fl_local_id
OutcomeDate = format(as.Date(substr(sari$de_fl_discharge_date, 1, 10), format = "%Y-%m-%d"), date_format)
Outcome = ifelse(sari$de_fl_discharge_status==1, "Discharge", ifelse(sari$de_fl_discharge_status==2,"Transfer", ifelse(sari$de_fl_discharge_status==3, "Death","Unknown")))
Temperature = sari$de_fl_fever_c
Ventilation = case_when(
sari$de_fl_mechanical_ventilation == "0" ~ "No",
sari$de_fl_mechanical_ventilation == "1" ~ "Yes",
sari$de_fl_mechanical_ventilation == "2" ~ "Yes",
sari$de_fl_mechanical_ventilation == "9" ~ NA,
TRUE ~ NA_character_  # Set default value to NA
)
ICUAddmission = ifelse(sari$de_fl_ward==3,"Yes","No")
AdmissionWard = case_when(
sari$de_fl_ward == "1" ~ "internal medicine",
sari$de_fl_ward == "2" ~ "pediatrics",
sari$de_fl_ward == "3" ~ "intensive care unit",
sari$de_fl_ward == "4" ~ "gyneco obstetrics",
sari$de_fl_ward == "5" ~ "other",
sari$de_fl_ward == "9" ~ "unspecified",
TRUE~NA
) ####
Pregnancy =  ifelse(sari$tea_fl_gender == 1, NA,
ifelse(sari$tea_fl_gender == 2, sari$de_fl_pregnancy, "No"))
Pregnancy = ifelse(Pregnancy=="1","Yes","No")
VaccinationForInfluenzaLast6months = ifelse(sari$de_fl_vaccination_flu==1 ,"Yes", ifelse(sari$de_fl_vaccination_flu==0,"No","Unknown"))
ReceiveInfluenzaAntiviralDrugsLast14days = ifelse(sari$de_fl_antiviral_treatement==1 ,"Yes", ifelse(sari$de_fl_antiviral_treatement==0,"No","Unknown"))
# Your initial data assignment
sari$de_fl_chronic_respiratory_diseases[sari$de_fl_chronic_respiratory_diseases == 1] <- "Chronic lung disease,"
sari$de_fl_chronic_cardiac_diseases[sari$de_fl_chronic_cardiac_diseases == 1] <- "Heart disease,"
sari$de_fl_diabetes[sari$de_fl_diabetes == 1] <- "Diabetes,"
sari$de_fl_chronic_liver_diseases[sari$de_fl_chronic_liver_diseases == 1] <- "Chronic liver disease,"
sari$de_fl_chronic_kidney_diseases[sari$de_fl_chronic_kidney_diseases == 1] <- "Chronic kidney disease,"
sari$de_fl_chronic_hematological_disorders[sari$de_fl_chronic_hematological_disorders == 1] <- "Chronic hematological disorder,"
sari$de_fl_neuromuscular_dysfunction[sari$de_fl_neuromuscular_dysfunction == 1] <- "Neuromuscular dysfunction,"
sari$de_fl_immuno_compromised[sari$de_fl_immuno_compromised == 1] <- "Immune compromised,"
sari$de_fl_other_diseases[sari$de_fl_other_diseases == 1] <- "Other,"
# Combine strings into one
`ChronicMedicalConditions (Comma Seperated)` <- paste(sari$de_fl_chronic_respiratory_diseases,
sari$de_fl_chronic_cardiac_diseases,
sari$de_fl_diabetes,
sari$de_fl_chronic_liver_diseases,
sari$de_fl_chronic_kidney_diseases,
sari$de_fl_chronic_hematological_disorders,
sari$de_fl_neuromuscular_dysfunction,
sari$de_fl_immuno_compromised,
sari$de_fl_other_diseases, sep = "")
# Remove NA and 0 from the string
`ChronicMedicalConditions (Comma Seperated)` <- gsub("NA", "", `ChronicMedicalConditions (Comma Seperated)`)
`ChronicMedicalConditions (Comma Seperated)` <- gsub("0", "", `ChronicMedicalConditions (Comma Seperated)`)
# Remove the last comma if it exists
`ChronicMedicalConditions (Comma Seperated)` <- sub(",\\s*$", "", `ChronicMedicalConditions (Comma Seperated)`)
`ChronicMedicalConditions (Comma Seperated)`[is.na(`ChronicMedicalConditions (Comma Seperated)`) | `ChronicMedicalConditions (Comma Seperated)`=="" | `ChronicMedicalConditions (Comma Seperated)`=="No"] = NA
test = `ChronicMedicalConditions (Comma Seperated)`
Lab_DateSpecimenCollected =  format(as.Date(substr(sari$de_fl_specimen_collection_date, 1, 10), format = "%Y-%m-%d"), date_format)
Lab_DateOfShipment = format(as.Date(substr(sari$de_fl_date_reception_specimen, 1, 10), format = "%Y-%m-%d"), date_format)
Lab_DateLabReceivedSpecimen = format(as.Date(substr(sari$de_fl_date_reception_specimen, 1, 10), format = "%Y-%m-%d"), date_format)
Lab_OropharyngealSpecimen = ifelse(sari$de_fl_specimen_type == 1, "Yes", "No")
Lab_NasopharyngealSpecimen = ifelse(sari$de_fl_specimen_type == 2, "Yes", "No")
Lab_BloodSpecimen = NA
Lab_SpecimenOther = ifelse(sari$de_fl_specimen_type == 8,"Yes", "No")
Lab_DateResultsReported = format(as.Date(substr(sari$de_fl_date_pcr_result, 1, 10), format = "%Y-%m-%d"), date_format)
Lab_Comments = NA
#### start lab result
influ = recode(
as.character(sari$de_fl_influenza_classification),
"a" = "influenza: a",
"ah1" = "Influenza: ah1",
"ah1ah3" = "influenza: ah1+ah3",
"ah3" = "influenza: ah3",
"ah5" = "influenza: ah5",
"ah7" = "influenza: ah7",
"b" = "influenza: b",
"bv" = "influenza: b victoria",
"by" = "influenza: b yamagata",
"2" = "Negative",
"9" = "Not tested",
"8" = "Other",
.default = NA_character_
)
covid = recode(
as.character(sari$de_fl_covid_classification),
"1" = "Positive [1]",
"2" = "Negative [2]",
"3" = "Border-Line [3]",
"4" = "Inadequate Sample [4",
.default = NA_character_
)
rsv  = recode(
as.character(sari$de_fl_pcr_rsv_classification),
"0" = "0_negative",
"1" = "1_positive",
"9" = "9_not processed",
.default = NA_character_
)
LabResult <- ifelse(
rsv %in% c("1_positive") |
covid %in% c("Positive [1]") |
influ %in% c(
"influenza: a", "Influenza: ah1", "influenza: ah3", "influenza: ah5",
"influenza: ah7", "influenza: b", "influenza: b yamagata",
"influenza: b victoria", "influenza: ah1+ah3", "Other"
), "Positive",
ifelse(
(influ == "Negative" & covid == "Negative [2]") | rsv != "1_positive",
"Negative",
ifelse(
influ == "Not tested" & covid == "Inadequate Sample [4" & rsv == "9_not processed",
"Not tested",
NA
)
)
)
LabResult = ifelse(is.na(LabResult),"Not tested",LabResult)
#### end lab result
#### PositiveViruses (Comma Seperated)
influ <- recode(
as.character(sari$de_fl_influenza_classification),
"a" = "Not-subtyped",
"ah1" = "(H1N1)pdm009",
"ah1ah3" = "Mixed",
"ah3" = "(H3N2)",
"ah5" = "(H5N1)",
"b" = "Lineage not determined",
"bv" = "Victoria lineage",
"by" = "Yamagata lineage",
.default = NA_character_
)
influ[influ==2] = NA # negative
influ[influ==9] = NA # not tested
PositiveViruses = character(nrow(sari))
for (i in 1:nrow(sari) ){
tested_virus_list <- character()
if (LabResult[i] == "Positive" && !is.na(influ[i]) && influ[i] != "Not tested" && influ[i] != "Negative") {
tested_virus_list <- c(tested_virus_list, influ[i])
}
if (LabResult[i] == "Positive" && !is.na(covid[i]) && covid[i]  == "Positive [1]") {
tested_virus_list <- c(tested_virus_list, "COVID-19")
}
if (LabResult[i] == "Positive" && !is.na(rsv[i]) && rsv[i] == "1_positive") {
tested_virus_list <- c(tested_virus_list, "RSV")
}
PositiveViruses[i] <- paste(tested_virus_list, collapse = ",")
}
`PositiveViruses (Comma Seperated)`=  PositiveViruses
#### end PositiveViruses (Comma Seperated)
HistoryTravel = ifelse(sari$de_fl_travel_history_21d==1,"Yes",ifelse(sari$de_fl_travel_history_21d==0,"No","Unknown"))
HistoryTravel_Where = country_code$Country[ match( sari$de_fl_country_visited,country_code$Alpha_3_code) ]
HistoryTravel_When = NA
VirusName_RSV = recode(
as.character(sari$de_fl_pcr_rsv_classification),
"0" = "negative",
"1" = "positive",
"9" = "not processed",
.default = NA_character_
)
# `TestedViruses (Comma Seperated)` = ifelse(VirusName_RSV=="negative" | VirusName_RSV=="positive","Not-subtyped, COVID-19, RSV","Not-subtyped, COVID-19")
# influ[is.na(influ)]=""
`TestedViruses (Comma Seperated)` = ifelse(VirusName_RSV=="negative" | VirusName_RSV=="positive","Not-subtyped,COVID-19,RSV","Not-subtyped,COVID-19")
`TestedViruses (Comma Seperated)`= ifelse((LabResult=="Negative" | LabResult=="Positive") & is.na(VirusName_RSV),"Not-subtyped,COVID-19",`TestedViruses (Comma Seperated)`)
# gsub("text", "word", string)
influ <- recode(
as.character(sari$de_fl_influenza_classification),
"a" = "Not-subtyped",
"ah1" = "(H1N1)pdm009",
"ah1ah3" = "Mixed",
"ah3" = "(H3N2)",
"ah5" = "(H5N1)",
"b" = "Lineage not determined",
"bv" = "Victoria lineage",
"by" = "Yamagata lineage",
.default = NA_character_
)
influ[influ==2] = NA #negative
influ[influ==9] = NA #not tested
`TestedViruses (Comma Seperated)`=ifelse(influ %in% c("(H1N1)pdm009", "Mixed", "(H3N2)", "(H5N1)", "Lineage not determined", "Victoria lineage", "Yamagata lineage"),str_replace(`TestedViruses (Comma Seperated)`,"Not-subtyped", influ), `TestedViruses (Comma Seperated)` )
ICUAddmissionDays = NA
VentilationDays = NA
DailySmoker = NA
NationalId = NA
District <- recode(District,
"Matn"="Metn",
"Beqaa Gharby" = "West Bekaa",
"Zgharta" = "Zghorta"
)
District[District=="Unspecified"] = NA
HistoryTravel_Where[HistoryTravel_Where=="United Arab Emirates (the)"] = "United Arab Emirates"
final_sari <- data.frame(
Country ,
Governorate ,
Site ,
Nationailty ,
Gender ,
Telephone ,
Address ,
BirthDate ,
AgeYear ,
AgeMonths ,
AddressGovernorate ,
District ,
FirstInterviewDate ,
AdmissionDate ,
SymptomOnsetDate ,
HospitalId ,
OutcomeDate ,
Outcome ,
Temperature ,
Ventilation ,
ICUAddmission ,
AdmissionWard ,
Pregnancy ,
VaccinationForInfluenzaLast6months ,
ReceiveInfluenzaAntiviralDrugsLast14days ,
`ChronicMedicalConditions (Comma Seperated)` ,
Lab_DateSpecimenCollected ,
Lab_DateOfShipment ,
Lab_DateLabReceivedSpecimen ,
Lab_OropharyngealSpecimen ,
Lab_NasopharyngealSpecimen ,
Lab_BloodSpecimen ,
Lab_SpecimenOther ,
Lab_DateResultsReported ,
Lab_Comments ,
LabResult ,
`PositiveViruses (Comma Seperated)` ,
HistoryTravel ,
HistoryTravel_Where ,
HistoryTravel_When ,
`TestedViruses (Comma Seperated)` ,
ICUAddmissionDays ,
VentilationDays ,
DailySmoker ,
NationalId
)
nrow(final_sari)
sites_to_keep_sari <- c("BDH505", "BRH610", "MDH122", "BLH201","BRH601","SDH430")
final_sari <- subset(final_sari, Site %in% sites_to_keep_sari)
nrow(final_sari)
final_sari$Governorate[final_sari$Governorate=="Baalbeck - Hermel"] = "Baalbeck-Hermel"
final_sari$AddressGovernorate[final_sari$AddressGovernorate=="Baalbeck - Hermel"] = "Baalbeck-Hermel"
final_sari$AddressGovernorate[final_sari$AddressGovernorate=="Unspecified"] = NA
names(final_sari)[names(final_sari) == "ChronicMedicalConditions..Comma.Seperated."] <- "ChronicMedicalConditions (Comma Seperated)"
names(final_sari)[names(final_sari) == "TestedViruses..Comma.Seperated."] <- "TestedViruses (Comma Seperated)"
names(final_sari)[names(final_sari) == "PositiveViruses..Comma.Seperated."] <- "PositiveViruses (Comma Seperated)"
today = Sys.Date()
write_xlsx(final_sari, path = here("output", paste0("sari_final_", today, "_update.xlsx")))
