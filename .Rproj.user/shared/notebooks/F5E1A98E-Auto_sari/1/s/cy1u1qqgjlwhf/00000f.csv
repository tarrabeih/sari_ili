"0","Country = ""Lebanon"""
"0","sub = substr( sari$organisation_unit_name,1,2)"
"0","sub_caza ="
"0","ifelse(sub==""AK"",""Akkar"","
"0","ifelse(sub==""AL"",""Aleyh"","
"0","ifelse(sub==""BD"",""Baabda"","
"0","ifelse(sub==""BL"",""Baalbeck"","
"0","ifelse(sub==""BT"",""Batroun"","
"0","ifelse(sub==""BC"",""Becharreh"","
"0","ifelse(sub==""BR"",""Beirut"","
"0","ifelse(sub==""WB"",""Beqaa Gharby"","
"0","ifelse(sub==""BJ"",""Bint Jbeil"","
"0","ifelse(sub==""CH"",""Chouf"","
"0","ifelse(sub==""HS"",""Hasbaya"","
"0","ifelse(sub==""HR"",""Hermel"","
"0","ifelse(sub==""JB"",""Jbeil"","
"0","ifelse(sub==""JZ"",""Jezzine"","
"0","ifelse(sub==""KW"",""Kesrwan"","
"0","ifelse(sub==""KR"",""Koura"","
"0","ifelse(sub==""MR"",""Marjeoun"","
"0","ifelse(sub==""MT"",""Matn"","
"0","ifelse(sub==""MD"",""Mineh Danieh"","
"0","ifelse(sub==""NB"",""Nabatieh"","
"0","ifelse(sub==""RS"",""Rashaya"","
"0","ifelse(sub==""SD"",""Saida"","
"0","ifelse(sub==""SR"",""Sour"","
"0","ifelse(sub==""TR"",""Tripoli"","
"0","ifelse(sub==""ZH"",""Zahleh"","
"0","ifelse(sub==""ZG"",""Zgharta"",""UN""))))))))))))))))))))))))))"
"0","Governorate = lbn_c$province[ match(sub_caza, lbn_c$caza) ] #match"
"0",""
"0","Site = substr(sari$organisation_unit_name,1,6)"
"0",""
"0","Nationailty =   country_code$Country[ match( sari$tea_fl_nationality,country_code$Alpha_3_code) ]"
"0","Nationailty = sub(c("", State of""), """", Nationailty)"
"0","Nationailty = sub(c("" Arab Republic""), """", Nationailty)"
"0",""
"0","Nationailty = recode("
"0","  Nationailty,"
"0","  ""Bangladesh""=""Bangladeshi"","
"0","  ""Egypt""=""Egyptian"","
"0","  ""Ethiopia""= ""Ethiopian"","
"0","  ""Ghana"" = ""Ghanaian"","
"0","  ""Iraq"" = ""Iraqi"","
"0","  ""Lebanon"" = ""Lebanese"","
"0","  ""Palestine"" = ""Palestinian"","
"0","  ""Romania"" = ""Romanian"","
"0","  ""Sri Lanka"" = ""Sri Lankan"","
"0","  ""Sudan (the)"" = ""Sudanese"","
"0","  ""Syrian Arab Republic"" = ""Syrian"","
"0","  ""Turkey"" = ""Turkish"","
"0","  ""Ukraine"" = ""Ukrainian"","
"0","  ""Philippines (the)"" = ""Filipino"","
"0","  ""Nigeria"" = ""Nigerian"""
"0","  )"
"0",""
"0",""
"0","Gender =  ifelse(sari$tea_fl_gender==""1"",""Male"", ifelse(sari$tea_fl_gender==""2"",""Female"",""Unknown""))"
"0",""
"0","Telephone = NA #check "
"0","Address =  NA #check"
"0",""
"0","BirthDate = format(as.Date(substr(sari$tea_fl_date_of_birth, 1, 10), format = ""%Y-%m-%d""), date_format)"
"0",""
"0",""
"0","# Convert the dates to Date objects"
"0","enroll_date <- as.Date(sari$de_fl_specimen_collection_date)"
"0","date_of_birth <- as.Date(substr(sari$tea_fl_date_of_birth, 1, 10))"
"0",""
"0","# Calculate the interval between the dates"
"0","interval <- interval(date_of_birth, enroll_date)"
"0",""
"0","# Convert the interval to a period"
"0","period <- as.period(interval)"
"0",""
"0","# Extract the number of years and months"
"0","AgeYear <- period@year"
"0","AgeMonths <- period@month"
"0","  "
"0","AgeMonths = ifelse(AgeMonths==""0"" & AgeYear==""0"", ""1"",AgeMonths)"
"0"," "
"0","AddressGovernorate = lbn_c$province[ match(sari$tea_fl_caza_of_residence, lbn_c$caza_code) ]"
"0",""
"0","District = lbn_c$caza[ match(sari$tea_fl_caza_of_residence, lbn_c$caza_code) ]"
"0",""
"0","# FirstInterviewDate =  format(as.Date(substr(sari$de_fl_specimen_collection_date, 1, 10), format = ""%Y-%m-%d""), date_format)"
"0","  FirstInterviewDate = NA #By Amir"
"0","AdmissionDate = format(as.Date(substr(sari$de_fl_hospital_admission_date, 1, 10), format = ""%Y-%m-%d""), date_format)"
"0","  "
"0","SymptomOnsetDate = format(as.Date(substr(sari$de_fl_date_onset, 1, 10), format = ""%Y-%m-%d""), date_format)"
"0","  "
"0","HospitalId = sari$tea_fl_local_id"
"0","  "
"0","OutcomeDate = format(as.Date(substr(sari$de_fl_discharge_date, 1, 10), format = ""%Y-%m-%d""), date_format)"
"0",""
"0","Outcome = ifelse(sari$de_fl_discharge_status==1, ""Discharge"", ifelse(sari$de_fl_discharge_status==2,""Transfer"", ifelse(sari$de_fl_discharge_status==3, ""Death"",""Unknown"")))"
"0","  "
"0","Temperature = sari$de_fl_fever_c"
"0",""
"0","Ventilation = case_when("
"0","  sari$de_fl_mechanical_ventilation == ""0"" ~ ""No"","
"0","  sari$de_fl_mechanical_ventilation == ""1"" ~ ""Yes"","
"0","  sari$de_fl_mechanical_ventilation == ""2"" ~ ""Yes"","
"0","    sari$de_fl_mechanical_ventilation == ""9"" ~ NA,"
"0","    TRUE ~ NA_character_  # Set default value to NA"
"0","  ) "
"0","  "
"0","ICUAddmission = ifelse(sari$de_fl_ward==3,""Yes"",""No"")"
"0",""
"0","AdmissionWard = case_when("
"0","  sari$de_fl_ward == ""1"" ~ ""internal medicine"","
"0","  sari$de_fl_ward == ""2"" ~ ""pediatrics"","
"0","  sari$de_fl_ward == ""3"" ~ ""intensive care unit"","
"0","  sari$de_fl_ward == ""4"" ~ ""gyneco obstetrics"","
"0","  sari$de_fl_ward == ""5"" ~ ""other"","
"0","  sari$de_fl_ward == ""9"" ~ ""unspecified"","
"0","  TRUE~NA"
"0",") #### "
"0","  "
"0","Pregnancy =  ifelse(sari$tea_fl_gender == 1, NA, "
"0","                    ifelse(sari$tea_fl_gender == 2, sari$de_fl_pregnancy, ""No""))"
"0"," "
"0"," Pregnancy = ifelse(Pregnancy==""1"",""Yes"",""No"")"
"0",""
"0","VaccinationForInfluenzaLast6months = ifelse(sari$de_fl_vaccination_flu==1 ,""Yes"", ifelse(sari$de_fl_vaccination_flu==0,""No"",""Unknown""))"
"0",""
"0","ReceiveInfluenzaAntiviralDrugsLast14days = ifelse(sari$de_fl_antiviral_treatement==1 ,""Yes"", ifelse(sari$de_fl_antiviral_treatement==0,""No"",""Unknown""))"
"0",""
"0","# Your initial data assignment"
"0","sari$de_fl_chronic_respiratory_diseases[sari$de_fl_chronic_respiratory_diseases == 1] <- ""Chronic lung disease,"""
"0","sari$de_fl_chronic_cardiac_diseases[sari$de_fl_chronic_cardiac_diseases == 1] <- ""Heart disease,"""
"0","sari$de_fl_diabetes[sari$de_fl_diabetes == 1] <- ""Diabetes,"""
"0","sari$de_fl_chronic_liver_diseases[sari$de_fl_chronic_liver_diseases == 1] <- ""Chronic liver disease,"""
"0","sari$de_fl_chronic_kidney_diseases[sari$de_fl_chronic_kidney_diseases == 1] <- ""Chronic kidney disease,"""
"0","sari$de_fl_chronic_hematological_disorders[sari$de_fl_chronic_hematological_disorders == 1] <- ""Chronic hematological disorder,"""
"0","sari$de_fl_neuromuscular_dysfunction[sari$de_fl_neuromuscular_dysfunction == 1] <- ""Neuromuscular dysfunction,"""
"0","sari$de_fl_immuno_compromised[sari$de_fl_immuno_compromised == 1] <- ""Immune compromised,"""
"0","sari$de_fl_other_diseases[sari$de_fl_other_diseases == 1] <- ""Other,"""
"0",""
"0","# Combine strings into one"
"0","`ChronicMedicalConditions (Comma Seperated)` <- paste(sari$de_fl_chronic_respiratory_diseases,"
"0","                                                      sari$de_fl_chronic_cardiac_diseases,"
"0","                                                      sari$de_fl_diabetes,"
"0","                                                      sari$de_fl_chronic_liver_diseases,"
"0","                                                      sari$de_fl_chronic_kidney_diseases,"
"0","                                                      sari$de_fl_chronic_hematological_disorders,"
"0","                                                      sari$de_fl_neuromuscular_dysfunction,"
"0","                                                      sari$de_fl_immuno_compromised,"
"0","                                                      sari$de_fl_other_diseases, sep = """")"
"0",""
"0","# Remove NA and 0 from the string"
"0","`ChronicMedicalConditions (Comma Seperated)` <- gsub(""NA"", """", `ChronicMedicalConditions (Comma Seperated)`)"
"0","`ChronicMedicalConditions (Comma Seperated)` <- gsub(""0"", """", `ChronicMedicalConditions (Comma Seperated)`)"
"0",""
"0","# Remove the last comma if it exists"
"0","`ChronicMedicalConditions (Comma Seperated)` <- sub("",\\s*$"", """", `ChronicMedicalConditions (Comma Seperated)`)"
"0",""
"0",""
"0","`ChronicMedicalConditions (Comma Seperated)`[is.na(`ChronicMedicalConditions (Comma Seperated)`) | `ChronicMedicalConditions (Comma Seperated)`=="""" | `ChronicMedicalConditions (Comma Seperated)`==""No""] = NA"
"0",""
"0","test = `ChronicMedicalConditions (Comma Seperated)` "
"0",""
"0","Lab_DateSpecimenCollected =  format(as.Date(substr(sari$de_fl_specimen_collection_date, 1, 10), format = ""%Y-%m-%d""), date_format)"
"0",""
"0","Lab_DateOfShipment = format(as.Date(substr(sari$de_fl_date_reception_specimen, 1, 10), format = ""%Y-%m-%d""), date_format)"
"0",""
"0","Lab_DateLabReceivedSpecimen = format(as.Date(substr(sari$de_fl_date_reception_specimen, 1, 10), format = ""%Y-%m-%d""), date_format)"
"0","  "
"0","Lab_OropharyngealSpecimen = ifelse(sari$de_fl_specimen_type == 1, ""Yes"", ""No"")"
"0","  "
"0","Lab_NasopharyngealSpecimen = ifelse(sari$de_fl_specimen_type == 2, ""Yes"", ""No"")  "
"0",""
"0","Lab_BloodSpecimen = NA"
"0",""
"0","Lab_SpecimenOther = ifelse(sari$de_fl_specimen_type == 8,""Yes"", ""No"")   "
"0",""
"0","Lab_DateResultsReported = format(as.Date(substr(sari$de_fl_date_pcr_result, 1, 10), format = ""%Y-%m-%d""), date_format)"
"0","Lab_Comments = NA"
"0",""
"0"," "
"0"," #### start lab result"
"0","influ = recode("
"0","    as.character(sari$de_fl_influenza_classification), "
"0","    ""a"" = ""influenza: a"","
"0","    ""ah1"" = ""Influenza: ah1"","
"0","    ""ah1ah3"" = ""influenza: ah1+ah3"","
"0","    ""ah3"" = ""influenza: ah3"","
"0","    ""ah5"" = ""influenza: ah5"","
"0","    ""ah7"" = ""influenza: ah7"","
"0","    ""b"" = ""influenza: b"","
"0","    ""bv"" = ""influenza: b victoria"","
"0","    ""by"" = ""influenza: b yamagata"","
"0","    ""2"" = ""Negative"","
"0","    ""9"" = ""Not tested"","
"0","    ""8"" = ""Other"","
"0","  .default = NA_character_"
"0","  )"
"0",""
"0","  "
"0","covid = recode("
"0","  as.character(sari$de_fl_covid_classification),"
"0","  ""1"" = ""Positive [1]"","
"0","  ""2"" = ""Negative [2]"","
"0","  ""3"" = ""Border-Line [3]"","
"0","  ""4"" = ""Inadequate Sample [4"","
"0","  .default = NA_character_"
"0",")"
"0",""
"0","rsv  = recode("
"0","  as.character(sari$de_fl_pcr_rsv_classification),"
"0","  ""0"" = ""0_negative"","
"0","  ""1"" = ""1_positive"","
"0","  ""9"" = ""9_not processed"","
"0","  .default = NA_character_"
"0",")"
"0",""
"0","LabResult <- ifelse("
"0","  rsv %in% c(""1_positive"") |"
"0","    covid %in% c(""Positive [1]"") |"
"0","    influ %in% c("
"0","      ""influenza: a"", ""Influenza: ah1"", ""influenza: ah3"", ""influenza: ah5"","
"0","      ""influenza: ah7"", ""influenza: b"", ""influenza: b yamagata"","
"0","      ""influenza: b victoria"", ""influenza: ah1+ah3"", ""Other"""
"0","    ), ""Positive"","
"0","  ifelse("
"0","    (influ == ""Negative"" & covid == ""Negative [2]"") | rsv != ""1_positive"","
"0","    ""Negative"","
"0","    ifelse("
"0","      influ == ""Not tested"" & covid == ""Inadequate Sample [4"" & rsv == ""9_not processed"","
"0","      ""Not tested"","
"0","      NA"
"0","    )"
"0","  )"
"0",")"
"0","LabResult = ifelse(is.na(LabResult),""Not tested"",LabResult)"
"0"," #### end lab result"
"0","  "
"0","#### PositiveViruses (Comma Seperated)"
"0","  "
"0","influ <- recode("
"0","  as.character(sari$de_fl_influenza_classification), "
"0","  ""a"" = ""Not-subtyped"","
"0","  ""ah1"" = ""(H1N1)pdm009"","
"0","  ""ah1ah3"" = ""Mixed"","
"0","  ""ah3"" = ""(H3N2)"","
"0","  ""ah5"" = ""(H5N1)"", "
"0","  ""b"" = ""Lineage not determined"","
"0","  ""bv"" = ""Victoria lineage"","
"0","  ""by"" = ""Yamagata lineage"",  "
"0","  .default = NA_character_"
"0",")"
"0","influ[influ==2] = NA # negative"
"0","influ[influ==9] = NA # not tested"
"0",""
"0","PositiveViruses = character(nrow(sari))"
"0","for (i in 1:nrow(sari) ){"
"0","  tested_virus_list <- character()"
"0","  "
"0","  if (LabResult[i] == ""Positive"" && !is.na(influ[i]) && influ[i] != ""Not tested"" && influ[i] != ""Negative"") {"
"0","    tested_virus_list <- c(tested_virus_list, influ[i])"
"0","  }"
"0","  "
"0","  if (LabResult[i] == ""Positive"" && !is.na(covid[i]) && covid[i]  == ""Positive [1]"") {"
"0","    tested_virus_list <- c(tested_virus_list, ""COVID-19"")"
"0","  }"
"0","  "
"0","  if (LabResult[i] == ""Positive"" && !is.na(rsv[i]) && rsv[i] == ""1_positive"") {"
"0","    tested_virus_list <- c(tested_virus_list, ""RSV"")"
"0","  }"
"0","  PositiveViruses[i] <- paste(tested_virus_list, collapse = "","")  "
"0"," "
"0","}"
"0"," `PositiveViruses (Comma Seperated)`=  PositiveViruses"
"0","#### end PositiveViruses (Comma Seperated)"
"0",""
"0",""
"0","HistoryTravel = ifelse(sari$de_fl_travel_history_21d==1,""Yes"",ifelse(sari$de_fl_travel_history_21d==0,""No"",""Unknown""))  "
"0","HistoryTravel_Where = country_code$Country[ match( sari$de_fl_country_visited,country_code$Alpha_3_code) ]"
"0","HistoryTravel_When = NA"
"0",""
"0","VirusName_RSV = recode("
"0","          as.character(sari$de_fl_pcr_rsv_classification),"
"0","          ""0"" = ""negative"","
"0","          ""1"" = ""positive"","
"0","          ""9"" = ""not processed"","
"0","          .default = NA_character_"
"0","        )"
"0",""
"0","# `TestedViruses (Comma Seperated)` = ifelse(VirusName_RSV==""negative"" | VirusName_RSV==""positive"",""Not-subtyped, COVID-19, RSV"",""Not-subtyped, COVID-19"")"
"0",""
"0","# influ[is.na(influ)]="""""
"0",""
"0"," "
"0",""
"0","`TestedViruses (Comma Seperated)` = ifelse(VirusName_RSV==""negative"" | VirusName_RSV==""positive"",""Not-subtyped,COVID-19,RSV"",""Not-subtyped,COVID-19"")"
"0",""
"0","`TestedViruses (Comma Seperated)`= ifelse((LabResult==""Negative"" | LabResult==""Positive"") & is.na(VirusName_RSV),""Not-subtyped,COVID-19"",`TestedViruses (Comma Seperated)`)"
"0",""
"0","# gsub(""text"", ""word"", string)"
"0",""
"0","influ <- recode("
"0","  as.character(sari$de_fl_influenza_classification), "
"0","  ""a"" = ""Not-subtyped"","
"0","  ""ah1"" = ""(H1N1)pdm009"","
"0","  ""ah1ah3"" = ""Mixed"","
"0","  ""ah3"" = ""(H3N2)"","
"0","  ""ah5"" = ""(H5N1)"", "
"0","  ""b"" = ""Lineage not determined"","
"0","  ""bv"" = ""Victoria lineage"","
"0","  ""by"" = ""Yamagata lineage"",  "
"0","  .default = NA_character_"
"0",")"
"0","influ[influ==2] = NA #negative"
"0","influ[influ==9] = NA #not tested"
"0",""
"0","`TestedViruses (Comma Seperated)`=ifelse(influ %in% c(""(H1N1)pdm009"", ""Mixed"", ""(H3N2)"", ""(H5N1)"", ""Lineage not determined"", ""Victoria lineage"", ""Yamagata lineage""),str_replace(`TestedViruses (Comma Seperated)`,""Not-subtyped"", influ), `TestedViruses (Comma Seperated)` )"
"2","Error in str_replace(`TestedViruses (Comma Seperated)`, ""Not-subtyped"",  : 
  could not find function ""str_replace""
"
